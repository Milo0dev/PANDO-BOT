<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= botName %> - Dashboard Profesional</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Elevar dinámicamente cualquier contenedor que tenga un dropdown abierto */
        div:has(.discord-ui-dropdown-container.is-open),
        li:has(.discord-ui-dropdown-container.is-open),
        article:has(.discord-ui-dropdown-container.is-open) {
            position: relative !important;
            z-index: 99999 !important;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #7289da;
            --primary-dark: #5b6eae;
            --secondary: #43b581;
            --danger: #ed4245;
            --warning: #faa61a;
            --dark-bg: #0f0f1a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #99aab5;
            --text-muted: #72767d;
            --gradient-1: linear-gradient(135deg, #7289da 0%, #5865f2 100%);
            --gradient-2: linear-gradient(135deg, #43b581 0%, #3ba55c 100%);
            --gradient-3: linear-gradient(135deg, #faa61a 0%, #f0b232 100%);
            --gradient-4: linear-gradient(135deg, #ed4245 0%, #eb0400 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(114, 137, 218, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(67, 181, 129, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 60%, rgba(250, 166, 26, 0.08) 0%, transparent 40%);
            animation: bgMove 20s ease-in-out infinite;
        }

        @keyframes bgMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, 2%) rotate(1deg); }
            66% { transform: translate(-1%, 1%) rotate(-1deg); }
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(114, 137, 218, 0.5);
            border-radius: 50%;
            animation: float 15s infinite;
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(100vh) rotate(0deg); 
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { 
                transform: translateY(-100vh) rotate(720deg); 
                opacity: 0;
            }
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(15, 15, 26, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--card-border);
            z-index: 999999 !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 5%;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .navbar-brand img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary);
        }

        .navbar-brand span {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .navbar-links {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .navbar-links a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 10px 18px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        .navbar-links a:hover {
            color: var(--text-primary);
            background: var(--card-bg);
        }

        .navbar-links a.active {
            color: var(--primary);
            background: rgba(114, 137, 218, 0.15);
        }

        .navbar-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(67, 181, 129, 0.15);
            border-radius: 20px;
            font-size: 0.85em;
            color: var(--secondary);
        }

        .nav-status-dot {
            width: 8px;
            height: 8px;
            background: var(--secondary);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.9); }
        }

        .main-content {
            padding-top: 70px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 5%;
        }

        .hero {
            text-align: center;
            padding: 80px 0 60px;
            position: relative;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 20px;
            background: rgba(114, 137, 218, 0.15);
            border: 1px solid rgba(114, 137, 218, 0.3);
            border-radius: 30px;
            font-size: 0.9em;
            color: var(--primary);
            margin-bottom: 30px;
            animation: fadeInDown 0.6s ease;
        }

        .hero-avatar {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 4px solid var(--primary);
            box-shadow: 0 0 60px rgba(114, 137, 218, 0.4);
            margin-bottom: 25px;
            animation: fadeInUp 0.6s ease 0.1s both;
        }

        .hero-title {
            font-size: 3.5em;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fff 0%, #99aab5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 0.6s ease 0.2s both;
        }

        .hero-tagline {
            font-size: 1.3em;
            color: var(--text-secondary);
            margin-bottom: 35px;
            animation: fadeInUp 0.6s ease 0.3s both;
        }

        .hero-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 0.6s ease 0.4s both;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 32px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1em;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 20px rgba(114, 137, 218, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(114, 137, 218, 0.5);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--card-border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-section {
            margin: 50px 0;
        }

        .section-title {
            text-align: center;
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .section-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-1);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .stat-card:nth-child(2)::before { background: var(--gradient-2); }
        .stat-card:nth-child(3)::before { background: var(--gradient-3); }
        .stat-card:nth-child(4)::before { background: var(--gradient-4); }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(114, 137, 218, 0.3);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            background: rgba(114, 137, 218, 0.15);
            border-radius: 50%;
            color: var(--primary);
        }

        .stat-card:nth-child(2) .stat-icon { 
            background: rgba(67, 181, 129, 0.15); 
            color: var(--secondary);
        }
        .stat-card:nth-child(3) .stat-icon { 
            background: rgba(250, 166, 26, 0.15); 
            color: var(--warning);
        }
        .stat-card:nth-child(4) .stat-icon { 
            background: rgba(237, 66, 69, 0.15); 
            color: var(--danger);
        }

        .stat-value {
            font-size: 2.8em;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 1em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .features-section {
            margin: 80px 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .feature-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.4s ease;
            position: relative;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(114, 137, 218, 0.15);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            background: var(--gradient-1);
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .feature-card:nth-child(2) .feature-icon { background: var(--gradient-2); }
        .feature-card:nth-child(3) .feature-icon { background: var(--gradient-3); }
        .feature-card:nth-child(4) .feature-icon { background: var(--gradient-4); }
        .feature-card:nth-child(5) .feature-icon { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); }
        .feature-card:nth-child(6) .feature-icon { background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%); }

        .feature-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .feature-desc {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.95em;
        }

        .commands-section {
            margin: 80px 0;
        }

        .commands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .command-chip {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 20px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .command-chip:hover {
            background: rgba(114, 137, 218, 0.15);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .command-chip i {
            color: var(--primary);
            width: 20px;
        }

        .about-section {
            margin: 80px 0;
            padding: 60px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            text-align: center;
        }

        .about-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .about-text {
            color: var(--text-secondary);
            font-size: 1.1em;
            line-height: 1.8;
            max-width: 800px;
            margin: 0 auto 30px;
        }

        .badges {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(114, 137, 218, 0.15);
            border: 1px solid rgba(114, 137, 218, 0.3);
            border-radius: 30px;
            font-size: 0.9em;
            color: var(--primary);
            font-weight: 500;
        }

        .badge i {
            font-size: 0.9em;
        }

        .footer {
            margin-top: 80px;
            padding: 40px 5%;
            border-top: 1px solid var(--card-border);
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            text-align: left;
        }

        .footer-section h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .footer-section a {
            display: block;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 6px 0;
            transition: color 0.3s ease;
            font-size: 0.95em;
        }

        .footer-section a:hover {
            color: var(--primary);
        }

        .footer-bottom {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer-copyright {
            color: var(--text-muted);
            font-size: 0.9em;
        }

        .footer-social {
            display: flex;
            gap: 15px;
        }

        .footer-social a {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .footer-social a:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .user-panel {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
        }

        .user-panel img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--secondary);
        }

        .user-panel-info {
            display: flex;
            flex-direction: column;
        }

        .user-panel-name {
            font-weight: 600;
            font-size: 0.95em;
        }

        .user-panel-logout {
            font-size: 0.8em;
            color: var(--danger);
            text-decoration: none;
            transition: color 0.3s;
        }

        .user-panel-logout:hover {
            color: #ff6b6b;
        }

        /* Server Selector */
        .server-selector {
            position: relative;
            display: inline-block;
            overflow: visible !important;
        }

        .server-selector-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            min-width: 200px;
        }

        .server-selector-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
        }

        .server-selector-btn img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .server-selector-btn .server-name {
            flex: 1;
            text-align: left;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
        }

        .server-selector-btn .dropdown-arrow {
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }

        .server-selector.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .server-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .server-selector.open .server-dropdown {
            display: block;
        }

        .server-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .server-option:hover {
            background: rgba(114, 137, 218, 0.15);
        }

        .server-option.active {
            background: rgba(114, 137, 218, 0.2);
            border-left: 3px solid var(--primary);
        }

        .server-option img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
        }

        .server-option-info {
            flex: 1;
            min-width: 0;
        }

        .server-option-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .server-option-members {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        /* Configuration Panel */
        .config-panel {
            display: none;
            margin-top: 30px;
        }

        .config-panel.active {
            display: block;
        }

        .config-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
        }

        .config-header img {
            width: 64px;
            height: 64px;
            border-radius: 16px;
        }

        .config-header-info h2 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .config-header-info p {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        /* Tabs */
        .config-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 10px;
            overflow-x: auto;
        }

        .config-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .config-tab:hover {
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .config-tab.active {
            background: var(--primary);
            color: white;
        }

        .config-content {
            display: none;
        }

        .config-content.active {
            display: block;
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .form-label small {
            display: block;
            font-weight: 400;
            color: var(--text-secondary);
            font-size: 0.85em;
            margin-top: 3px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(114, 137, 218, 0.2);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        /* Toggle Switch */
        .toggle-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .toggle-info h4 {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .toggle-info p {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--text-muted);
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--secondary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Save Button */
        .save-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 40px;
            background: var(--gradient-1);
            color: white;
            border: none;
            border-radius: 14px;
            font-weight: 600;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(114, 137, 218, 0.3);
        }

        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(114, 137, 218, 0.5);
        }

        .save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .save-btn .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .save-btn.loading .spinner {
            display: block;
        }

        .save-btn.loading .btn-text {
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== NUEVO DISEÑO VISUAL - TARJETAS Y MENÚS ===== */
        
        /* Visual Cards para configuración - MODERN DARK UI */
        .visual-card, .pando-setting-card {
            background-color: #111214 !important; /* Un fondo más profundo y oscuro */
            border: 1px solid rgba(255, 255, 255, 0.06) !important; /* Borde sutil estilo cristal */
            border-radius: 12px !important; /* Curvas más modernas */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
            /* CORRECCIÓN 1: Evita 'transition: all' que rompe el stacking context */
            transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease !important;
            overflow: visible !important; /* Vital para no cortar los dropdowns flotantes */
            padding: 24px;
            margin-bottom: 16px;
            position: relative;
        }

        /* 1. Elevación normal en Hover (Jerarquía baja) */
        .visual-card:hover, 
        .pando-setting-card:hover {
            z-index: 9999 !important;
            position: relative !important;
            transform: translateY(-2px) !important;
            border-color: rgba(88, 101, 242, 0.4) !important;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2) !important;
        }

        /* 2. Elevación SUPREMA para la tarjeta activa (Jerarquía invencible) */
        .visual-card:has(.discord-ui-dropdown-container.is-open),
        .pando-setting-card:has(.discord-ui-dropdown-container.is-open) {
            z-index: 999999 !important; 
            position: relative !important;
            transform: translateY(-2px) !important;
            border-color: rgba(88, 101, 242, 0.4) !important;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2) !important;
        }

        /* 3. Elevación del contenedor padre en cuadrículas o listas (Sin límite de hijo directo) */
        div:has(.visual-card:has(.discord-ui-dropdown-container.is-open)),
        div:has(.pando-setting-card:has(.discord-ui-dropdown-container.is-open)),
        li:has(.visual-card:has(.discord-ui-dropdown-container.is-open)),
        li:has(.pando-setting-card:has(.discord-ui-dropdown-container.is-open)),
        article:has(.visual-card:has(.discord-ui-dropdown-container.is-open)),
        article:has(.pando-setting-card:has(.discord-ui-dropdown-container.is-open)) {
            z-index: 999999 !important;
            position: relative !important;
        }

        .visual-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .visual-card-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 10px;
            font-size: 1.3em;
            color: var(--primary);
        }

        .visual-card-title {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
        }

        .visual-card-desc {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Selector visual (dropdown mejorado) */
        .visual-select {
            position: relative;
        }

        .visual-select-btn {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .visual-select-btn:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: var(--primary);
        }

        .visual-select-btn .value {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .visual-select-btn .arrow {
            transition: transform 0.3s ease;
            color: var(--text-secondary);
        }

        .visual-select.open .visual-select-btn .arrow {
            transform: rotate(180deg);
        }

        .visual-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: #1a1a2e;
            border: 1px solid var(--card-border);
            border-radius: 12px;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .visual-select.open .visual-select-dropdown {
            display: block;
        }

        .visual-select-option {
            padding: 12px 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .visual-select-option:last-child {
            border-bottom: none;
        }

        .visual-select-option:hover {
            background: rgba(114, 137, 218, 0.15);
        }

        .visual-select-option.selected {
            background: rgba(114, 137, 218, 0.2);
            border-left: 3px solid var(--primary);
        }

        .visual-select-option .option-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(114, 137, 218, 0.1);
            border-radius: 8px;
            font-size: 0.85em;
        }

        /* Grid de tarjetas visuales */
        .visual-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            overflow: visible !important;
        }

        /* Toggle mejorado con icono */
        .toggle-group-visual {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 22px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 14px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .toggle-group-visual:hover {
            border-color: rgba(114, 137, 218, 0.3);
            background: rgba(255, 255, 255, 0.06);
        }

        .toggle-group-visual.active {
            border-color: rgba(67, 181, 129, 0.5);
            background: rgba(67, 181, 129, 0.1);
        }

        .toggle-visual-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .toggle-visual-icon {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(114, 137, 218, 0.15);
            border-radius: 12px;
            font-size: 1.2em;
            color: var(--primary);
            transition: all 0.3s ease;
        }

        .toggle-group-visual.active .toggle-visual-icon {
            background: rgba(67, 181, 129, 0.2);
            color: var(--secondary);
        }

        .toggle-visual-text h4 {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .toggle-visual-text p {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* Input visual de canal/rol */
        .channel-input-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .channel-input-wrapper:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .channel-input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(114, 137, 218, 0.15);
        }

        .channel-input-wrapper i {
            font-size: 1.1em;
            color: var(--text-secondary);
            width: 24px;
            text-align: center;
        }

        .channel-input-wrapper .form-input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 8px 0;
            cursor: pointer;
        }

        .channel-input-wrapper .form-input:focus {
            box-shadow: none;
        }

        /* Dropdown de Canal */
        .channel-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: #1a1a2e;
            border: 1px solid var(--card-border);
            border-radius: 12px;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .channel-dropdown.open {
            display: block;
        }

        .channel-dropdown-header {
            padding: 10px 16px;
            font-size: 0.8em;
            color: var(--text-muted);
            border-bottom: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .channel-dropdown-header i {
            width: auto;
        }

        .channel-category {
            padding: 8px 16px;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text-secondary);
            background: rgba(114, 137, 218, 0.1);
            border-bottom: 1px solid var(--card-border);
        }

        .channel-option {
            padding: 10px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .channel-option:last-child {
            border-bottom: none;
        }

        .channel-option:hover {
            background: rgba(114, 137, 218, 0.15);
        }

        .channel-option.selected {
            background: rgba(114, 137, 218, 0.2);
            border-left: 3px solid var(--primary);
        }

        .channel-option .channel-icon {
            width: 20px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .channel-option .channel-name {
            flex: 1;
            font-size: 0.95em;
        }

        .channel-option.selected .channel-name {
            color: var(--primary);
            font-weight: 500;
        }

        .channel-option.none {
            color: var(--text-muted);
            font-style: italic;
        }

        /* ===== CUSTOM CHANNEL DROPDOWN - DISCORD STYLE ===== */
        .custom-dropdown {
            position: relative;
            width: 100%;
            max-width: 400px;
            overflow: visible;
        }

        .custom-dropdown-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 46px;
        }

        .custom-dropdown-trigger:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: var(--primary);
        }

        .custom-dropdown-trigger .dropdown-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .custom-dropdown-trigger .dropdown-label i {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(114, 137, 218, 0.15);
            border-radius: 6px;
            color: var(--primary);
            font-size: 0.85em;
        }

        .custom-dropdown-trigger .dropdown-value {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.95em;
        }

        .custom-dropdown-trigger .dropdown-value.placeholder {
            color: var(--text-muted);
        }

        .custom-dropdown-trigger .dropdown-chevron {
            color: var(--text-secondary);
            font-size: 0.8em;
            transition: transform 0.2s ease;
        }

        .custom-dropdown.open .custom-dropdown-trigger {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(114, 137, 218, 0.15);
        }

        .custom-dropdown.open .dropdown-chevron {
            transform: rotate(180deg);
            color: var(--primary);
        }

        /* ===== DISCORD CHANNEL WRAPPER - UNIQUE CLASSES ===== */
        /* ===== NUEVO DISEÑO - DISCORD UI DROPDOWN ESTÁNDAR ===== */
        
        /* Contenedor principal relativo - INNEGOCIABLE para que no desplace contenido */
        .discord-ui-dropdown-container {
            position: relative !important;
            width: 100%;
            max-width: 400px;
            overflow: visible !important;
        }

        /* El botón gatillo */
        .discord-ui-dropdown-trigger {
            background-color: #1e1f22;
            color: #dbdee1;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #2b2d31;
            transition: all 0.2s ease;
        }

        .discord-ui-dropdown-trigger:hover {
            border-color: #404249;
            background-color: #202225;
        }

        /* --- INICIO DEL DISEÑO CLONADO DE TICKETS --- */

        /* 1. Contenedor Principal (Fondo oscuro azulado exacto al de Tickets) */
        .discord-ui-dropdown-menu {
            display: none !important;
            position: absolute !important;
            top: calc(100% + 5px) !important;
            left: 0 !important;
            width: 100% !important;
            max-height: 300px !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            background-color: #16181d !important; /* El tono exacto del dashboard */
            border: 1px solid #2a2c36 !important;
            border-radius: 8px !important; /* Bordes suaves */
            box-shadow: 0 10px 25px rgba(0,0,0,0.5) !important;
            box-sizing: border-box !important;
            padding: 6px 0 !important;
            z-index: 999999 !important;
        }

        /* 2. Opciones (Base para la animación) */
        .discord-ui-option {
            padding: 10px 16px !important;
            cursor: pointer !important;
            color: #a3a6aa !important; /* Color de texto en reposo */
            border-left: 3px solid transparent !important; /* Borde invisible listo para animar */
            /* ESTA ES LA CLAVE DE LA ANIMACIÓN SUAVE: */
            transition: all 0.15s ease-in-out !important;
            font-size: 14px !important;
            font-weight: 500 !important;
            display: flex !important;
            align-items: center !important;
            gap: 10px !important; /* Separación perfecta entre icono y texto */
        }

        /* 3. Estado HOVER (La animación y colores exactos de Tickets) */
        .discord-ui-option:hover {
            background-color: #262936 !important; /* El resalte azul marino */
            border-left-color: #5865F2 !important; /* Aparece la franja azul de Discord */
            color: #ffffff !important; /* Texto blanco brillante */
        }

        /* 4. Categorías (Alineadas y limpias) */
        .discord-ui-category {
            padding: 16px 16px 6px 16px !important;
            font-size: 11px !important;
            font-weight: 800 !important;
            color: #72767d !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            pointer-events: none !important;
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }
        /* --- FIN DEL DISEÑO CLONADO --- */

        /* --- EL INTERRUPTOR QUE FALTA Y SU ANIMACIÓN --- */
        .discord-ui-dropdown-container.is-open .discord-ui-dropdown-menu {
            display: block !important;
animation: discordDropdownFadeIn 0.15s ease-out both !important;
        }

        @keyframes discordDropdownFadeIn {
            from { 
                opacity: 0; 
                transform: translateY(-8px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        /* ----------------------------------------------- */

        /* Clase para el icono de la flecha */
        .discord-ui-arrow {
            display: inline-block !important; /* Necesario para que la transformación funcione en un span */
            transition: transform 0.2s ease-in-out !important; /* Suaviza el giro */
        }

        /* Estado rotado cuando el menú está abierto */
        .discord-ui-dropdown-container.is-open .discord-ui-arrow {
            transform: rotate(180deg) !important; /* Gira 180 grados (apunta hacia arriba) */
        }

        /* Selector de Rol */
        .role-option {
            padding: 10px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .role-option:last-child {
            border-bottom: none;
        }

        .role-option:hover {
            background: rgba(114, 137, 218, 0.15);
        }

        .role-option.selected {
            background: rgba(114, 137, 218, 0.2);
            border-left: 3px solid var(--primary);
        }

        .role-option .role-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .role-option .role-name {
            flex: 1;
            font-size: 0.95em;
        }

        .role-option.selected .role-name {
            color: var(--primary);
            font-weight: 500;
        }

        .role-option.none {
            color: var(--text-muted);
            font-style: italic;
        }

        .channel-input-relative {
            position: relative;
        }

        /* Pestañas mejoradas */
        .config-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 15px;
            overflow-x: auto;
            padding-top: 10px;
        }

        .config-tab {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 22px;
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.95em;
        }

        .config-tab i {
            font-size: 1.1em;
            width: 20px;
            text-align: center;
        }

        .config-tab:hover {
            background: var(--card-bg);
            color: var(--text-primary);
            border-color: var(--card-border);
        }

        .config-tab.active {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 15px rgba(114, 137, 218, 0.4);
        }

        /* Estado vacío mejorado */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: var(--card-bg);
            border: 2px dashed var(--card-border);
            border-radius: 20px;
        }

        .empty-state i {
            font-size: 5em;
            color: var(--text-muted);
            margin-bottom: 25px;
            background: rgba(114, 137, 218, 0.1);
            padding: 30px;
            border-radius: 50%;
        }

        .empty-state h3 {
            font-size: 1.6em;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .empty-state p {
            color: var(--text-secondary);
            font-size: 1.05em;
        }

        /* Mantenimiento card especial */
        .maintenance-card {
            background: linear-gradient(135deg, rgba(250, 166, 26, 0.1) 0%, rgba(237, 66, 69, 0.1) 100%);
            border: 1px solid rgba(250, 166, 26, 0.3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 25px;
        }

        .maintenance-card.active {
            background: linear-gradient(135deg, rgba(237, 66, 69, 0.2) 0%, rgba(200, 50, 50, 0.2) 100%);
            border-color: rgba(237, 66, 69, 0.5);
        }

        .maintenance-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(250, 166, 26, 0.2);
            border-radius: 50%;
            font-size: 2em;
            color: var(--warning);
        }

        .maintenance-card.active .maintenance-icon {
            background: rgba(237, 66, 69, 0.3);
            color: var(--danger);
            animation: pulse-danger 2s infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 0 0 0 rgba(237, 66, 69, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(237, 66, 69, 0); }
        }

        .maintenance-card h3 {
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .maintenance-card p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        /* Config header mejorado */
        .config-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 35px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(114, 137, 218, 0.1) 0%, rgba(88, 101, 242, 0.1) 100%);
            border: 1px solid rgba(114, 137, 218, 0.2);
            border-radius: 20px;
        }

        .config-header img {
            width: 72px;
            height: 72px;
            border-radius: 20px;
            border: 3px solid var(--primary);
        }

        .config-header-info h2 {
            font-size: 1.6em;
            margin-bottom: 6px;
            background: linear-gradient(135deg, #fff 0%, #99aab5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .config-header-info p {
            color: var(--text-secondary);
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-header-info p i {
            color: var(--secondary);
        }

        /* Título de sección con icono */
        .section-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 22px;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--card-border);
        }

        .section-header i {
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-1);
            border-radius: 12px;
            font-size: 1.1em;
        }

        .section-header h3 {
            font-size: 1.25em;
            font-weight: 700;
        }

        /* Quick actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action-btn:hover {
            background: rgba(114, 137, 218, 0.15);
            color: var(--text-primary);
            border-color: var(--primary);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .toast.success {
            background: var(--secondary);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
            color: #000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state i {
            font-size: 4em;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: var(--text-secondary);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 26, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-overlay .spinner-large {
            width: 50px;
            height: 50px;
            border: 3px solid var(--card-border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Section Cards */
        .config-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .config-section-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-section-title i {
            color: var(--primary);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--card-border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 0 20px;
            }

            .navbar-links {
                display: none;
            }

            .hero-title {
                font-size: 2.2em;
            }

            .hero-tagline {
                font-size: 1.1em;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                text-align: center;
            }

            .footer-bottom {
                flex-direction: column;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .hero-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* ==================== BLOQUEO GLOBAL (GLOBAL LOCK) ==================== */
        /* Solución definitiva al problema de superposición de menús en el Grid */

        /* 1. ELEVACIÓN MASIVA: Todo contenedor que tenga un menú abierto adentro sube al máximo nivel, rompiendo la celda del Grid */
        div:has(.discord-ui-dropdown-container.is-open) {
            z-index: 999999 !important;
        }

        /* 2. EL BLOQUEO GLOBAL: Si hay CUALQUIER menú abierto en el body, las DEMÁS tarjetas se vuelven invisibles para el ratón */
        body:has(.discord-ui-dropdown-container.is-open) .pando-setting-card:not(:has(.discord-ui-dropdown-container.is-open)) {
            pointer-events: none !important; /* El ratón las traspasa y las ignora */
            transform: none !important; /* Impide que se eleven */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important; /* Mantiene sombra base */
            border-color: rgba(255, 255, 255, 0.06) !important; /* Mantiene el borde apagado */
            z-index: 0 !important; /* Las manda al fondo */
        }

        /* 2b. EL BLOQUEO GLOBAL para visual-card también */
        body:has(.discord-ui-dropdown-container.is-open) .visual-card:not(:has(.discord-ui-dropdown-container.is-open)) {
            pointer-events: none !important; /* El ratón las traspasa y las ignora */
            transform: none !important; /* Impide que se eleven */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important; /* Mantiene sombra base */
            border-color: rgba(255, 255, 255, 0.06) !important; /* Mantiene el borde apagado */
            z-index: 0 !important; /* Las manda al fondo */
        }

        /* 3. PROTECCIÓN DEL MENÚ ACTIVO: Asegura que el menú que SÍ está abierto siga recibiendo clics */
        .pando-setting-card:has(.discord-ui-dropdown-container.is-open) {
            pointer-events: auto !important;
        }

        /* 3b. PROTECCIÓN DEL MENÚ ACTIVO para visual-card también */
        .visual-card:has(.discord-ui-dropdown-container.is-open) {
            pointer-events: auto !important;
        }

        /* ==================== CORRECCIÓN ANTI-FLICKER ==================== */
        /* Elimina el flicker en las transiciones evitando que z-index se anime */

        /* 1. CONGELA LAS TRANSICIONES: Excluye z-index de las transiciones */
        .visual-card,
        .pando-setting-card,
        .visual-card:hover,
        .pando-setting-card:hover,
        .visual-card:has(.discord-ui-dropdown-container.is-open),
        .pando-setting-card:has(.discord-ui-dropdown-container.is-open) {
            transition-property: transform, border-color, box-shadow, background-color !important;
            transition-duration: 0.2s !important;
        }

        /* 2. Z-INDEX INSTANTÁNEO: Cambia al instante sin transición */
        .visual-card,
        .pando-setting-card {
            transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease !important;
        }

        /* 3. CONTENEDOR PADRE ESTABLE: La celda Grid no se anima */
        div:has(> .visual-card),
        div:has(> .pando-setting-card),
        .visual-cards-grid {
            transition: none !important;
        }

        /* 4. ASEGURA z-index INSTANTÁNEO: Prioridad absoluta para menús abiertos */
        .discord-ui-dropdown-container.is-open {
            z-index: 999999 !important;
        }

        /* ==================== BLOQUEO TOTAL ANTI-FLICKER ==================== */
        /* Solución definitiva: Congelar la tarjeta activa para evitar el Stacking Context temporal */

        /* 1. CONGELAR LA TARJETA ACTIVA (La clave absoluta) */
        .pando-setting-card:has(.discord-ui-dropdown-container.is-open) {
            transition: none !important; /* PROHIBE la animación para evitar el salto de z-index */
            transform: translateY(-2px) !important; /* La mantiene elevada de forma fija e inamovible */
            border-color: rgba(88, 101, 242, 0.4) !important;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2) !important;
            z-index: 999999 !important;
        }

        /* 1b. CONGELAR LA TARJETA ACTIVA para visual-card también */
        .visual-card:has(.discord-ui-dropdown-container.is-open) {
            transition: none !important; /* PROHIBE la animación para evitar el salto de z-index */
            transform: translateY(-2px) !important; /* La mantiene elevada de forma fija e inamovible */
            border-color: rgba(88, 101, 242, 0.4) !important;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2) !important;
            z-index: 999999 !important;
        }

        /* 2. CONGELAR LA CELDA DEL GRID PADRE */
        div:has(.discord-ui-dropdown-container.is-open) {
            transition: none !important; /* evita que el contenedor intente animarse */
            z-index: 999999 !important;
            position: relative !important;
        }

        /* 3. ASEGURAR EL MENÚ FLOTANTE AL MÁXIMO NIVEL */
        .discord-ui-dropdown-menu {
            z-index: 9999999 !important; /* Añadimos un 9 extra para garantizar que venza a su propia tarjeta */
        }

        /* ==================== CORRECCIÓN ADICIONAL: ANTI-UNHOVER GLITCH ==================== */
        /* El problema: al hacer unhover mientras el dropdown está abierto, el estado hover se desvanece
           y causa un glitch de z-index. La solución: forzar que la tarjeta con dropdown abierto
           ignore completamente las reglas de hover durante la transición */

        /* 4. BLOQUEAR COMPLETAMENTE las reglas hover cuando hay dropdown abierto - SIN :hover */
        .pando-setting-card:has(.discord-ui-dropdown-container.is-open) {
            transition: none !important;
            transform: translateY(-2px) !important;
            border-color: rgba(88, 101, 242, 0.4) !important;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2) !important;
            z-index: 999999 !important;
        }

        /* 5. La regla de BLOQUEO GLOBAL debe respetar la tarjeta activa - NO aplicar z-index: 0 */
        body:has(.discord-ui-dropdown-container.is-open) .pando-setting-card:has(.discord-ui-dropdown-container.is-open),
        body:has(.discord-ui-dropdown-container.is-open) .visual-card:has(.discord-ui-dropdown-container.is-open) {
            z-index: 999999 !important;
            pointer-events: auto !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2) !important;
            border-color: rgba(88, 101, 242, 0.4) !important;
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="particles" id="particles"></div>
    
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner-large"></div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <nav class="navbar">
        <a href="/" class="navbar-brand">
            <img src="<%= botAvatar %>" alt="<%= botName %>">
            <span><%= botName %></span>
        </a>
        
        <div class="navbar-links">
            <a href="#" class="active" onclick="showHome()"><i class="fas fa-home"></i> Inicio</a>
            <a href="#" onclick="showConfig()"><i class="fas fa-cog"></i> Configuración</a>
            <a href="#features"><i class="fas fa-star"></i> Características</a>
            <a href="#commands"><i class="fas fa-terminal"></i> Comandos</a>
        </div>
        
        <div class="navbar-user">
            <% if (user) { %>
            <div class="user-panel">
                <img src="https://cdn.discordapp.com/avatars/<%= user.id %>/<%= user.avatar %>.png?size=64" alt="<%= user.username %>">
                <div class="user-panel-info">
                    <span class="user-panel-name"><%= user.global_name || user.username %></span>
                    <a href="/logout" class="user-panel-logout">Cerrar Sesión</a>
                </div>
            </div>
            <% } %>
            <div class="nav-status">
                <span class="nav-status-dot"></span>
                <span>En línea</span>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <!-- Home Section -->
            <div id="homeSection">
                <section class="hero">
                    <div class="hero-badge">
                        <i class="fas fa-check-circle"></i>
                        Bot de Discord Premium
                    </div>
                    
                    <img src="<%= botAvatar %>" alt="<%= botName %>" class="hero-avatar">
                    
                    <h1 class="hero-title"><%= botName %></h1>
                    <p class="hero-tagline">🤖 Potencia tu servidor con funciones avanzadas de moderación, economía, entretenimiento y más</p>
                    
                    <div class="hero-actions">
                        <a href="#" class="btn btn-primary" onclick="showConfig()">
                            <i class="fas fa-cog"></i>
                            Configurar Servidor
                        </a>
                        <a href="#features" class="btn btn-secondary">
                            <i class="fas fa-arrow-right"></i>
                            Ver Características
                        </a>
                    </div>
                </section>

                <section class="stats-section">
                    <h2 class="section-title">📊 Estadísticas en Tiempo Real</h2>
                    <p class="section-subtitle">Monitorea el rendimiento y actividad del bot</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-server"></i>
                            </div>
                            <div class="stat-value"><%= serverCount %></div>
                            <div class="stat-label">Servidores</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value"><%= userCount.toLocaleString() %></div>
                            <div class="stat-label">Usuarios Totales</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="stat-value"><%= ping %>ms</div>
                            <div class="stat-label">Latencia</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-value"><%= uptime %></div>
                            <div class="stat-label">Tiempo Activo</div>
                        </div>
                    </div>
                </section>

                <section class="features-section" id="features">
                    <h2 class="section-title">⭐ Características Destacadas</h2>
                    <p class="section-subtitle">Descubre todo lo que <%= botName %> puede hacer por tu servidor</p>
                    
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-ticket-alt"></i>
                            </div>
                            <h3 class="feature-title">🎫 Sistema de Tickets</h3>
                            <p class="feature-desc">Sistema completo de tickets con categorías, paneles personalizados y transcripciones automáticas.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <h3 class="feature-title">💰 Economía</h3>
                            <p class="feature-desc">Sistema de economía con diarios, trabajo, casino, tienda y economía global entre servidores.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-music"></i>
                            </div>
                            <h3 class="feature-title">🎵 Música</h3>
                            <p class="feature-desc">Reprodutor de música con colas, playlists, efectos de audio y soporte para múltiples plataformas.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3 class="feature-title">🛡️ Moderación</h3>
                            <p class="feature-desc">Herramientas avanzadas de moderación: logs, mute, ban, warn, anti-spam y anti-raid.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3 class="feature-title">📈 Niveles</h3>
                            <p class="feature-desc">Sistema de XP y niveles con rangos personalizados, recompensas y leaderboards.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-gift"></i>
                            </div>
                            <h3 class="feature-title">🎁 Sorteos</h3>
                            <p class="feature-desc">Crea sorteos personalizados con múltiples ganadores, roles requeridos y mensajes automatizados.</p>
                        </div>
                    </div>
                </section>

                <section class="commands-section" id="commands">
                    <h2 class="section-title">⌨️ Comandos Disponibles</h2>
                    <p class="section-subtitle">Explora todos los comandos disponibles para usar en tu servidor</p>
                    
                    <div class="commands-grid">
                        <a href="#" class="command-chip">
                            <i class="fas fa-ticket-simple"></i>
                            /ticket
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-chart-bar"></i>
                            /economy
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-play"></i>
                            /play
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-gavel"></i>
                            /modlogs
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-user-plus"></i>
                            /verify
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-poll"></i>
                            /poll
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-lightbulb"></i>
                            /suggest
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-level-up-alt"></i>
                            /rank
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-bell"></i>
                            /remind
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-crown"></i>
                            /staff
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-palette"></i>
                            /embed
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-dice"></i>
                            /games
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-hand-sparkles"></i>
                            /giveaway
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-sliders-h"></i>
                            /setup
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-robot"></i>
                            /help
                        </a>
                        <a href="#" class="command-chip">
                            <i class="fas fa-wifi"></i>
                            /ping
                        </a>
                    </div>
                </section>

                <section class="about-section" id="about">
                    <h2 class="about-title">🤖 Acerca de <%= botName %></h2>
                    <p class="about-text">
                        <%= botName %> es un bot de Discord multifuncional diseñado para mejorar la experiencia de tu servidor. 
                        Con más de 50 comandos disponibles, incluyendo moderación, economía, música, entretenimiento y más. 
                        Nuestro objetivo es proporcionar herramientas potentes y fáciles de usar para administradores de servidores.
                    </p>
                    
                    <div class="badges">
                        <span class="badge"><i class="fas fa-shield-alt"></i> Seguridad Avanzada</span>
                        <span class="badge"><i class="fas fa-bolt"></i> Alta Velocidad</span>
                        <span class="badge"><i class="fas fa-sync"></i> Actualizaciones Constantes</span>
                        <span class="badge"><i class="fas fa-headset"></i> Soporte 24/7</span>
                        <span class="badge"><i class="fas fa-globe"></i> Multi-idioma</span>
                        <span class="badge"><i class="fas fa-heart"></i> Communidad Activa</span>
                    </div>
                </section>
            </div>

            <!-- Configuration Section -->
            <div id="configSection" style="display: none;">
                <h2 class="section-title">⚙️ Configuración del Servidor</h2>
                <p class="section-subtitle">Selecciona un servidor para configurar sus opciones</p>
                
                <!-- Server Selector -->
                <div class="server-selector" id="serverSelector">
                    <button class="server-selector-btn" onclick="toggleServerDropdown()">
                        <img src="<%= botAvatar %>" alt="Server" id="selectedServerIcon">
                        <span class="server-name" id="selectedServerName">Seleccionar servidor...</span>
                        <span class="dropdown-arrow"><i class="fas fa-chevron-down"></i></span>
                    </button>
                    <div class="server-dropdown" id="serverDropdown">
                        <!-- Servers will be loaded here -->
                    </div>
                </div>

                <!-- Config Panel -->
                <div class="config-panel" id="configPanel">
                    <div class="config-header">
                        <img src="<%= botAvatar %>" alt="Server" id="configServerIcon">
                        <div class="config-header-info">
                            <h2 id="configServerName">Servidor</h2>
                            <p id="configServerId">ID: -</p>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="config-tabs">
                        <button class="config-tab active" onclick="switchTab('channels')">
                            <i class="fas fa-hashtag"></i> Canales
                        </button>
                        <button class="config-tab" onclick="switchTab('roles')">
                            <i class="fas fa-user-tag"></i> Roles
                        </button>
                        <button class="config-tab" onclick="switchTab('tickets')">
                            <i class="fas fa-ticket-alt"></i> Tickets
                        </button>
                        <button class="config-tab" onclick="switchTab('automation')">
                            <i class="fas fa-robot"></i> Automatización
                        </button>
                        <button class="config-tab" onclick="switchTab('dm')">
                            <i class="fas fa-envelope"></i> DM
                        </button>
                        <button class="config-tab" onclick="switchTab('maintenance')">
                            <i class="fas fa-tools"></i> Mantenimiento
                        </button>
                    </div>

                    <!-- Channels Tab -->
                    <div class="config-content active" id="tab-channels">
                        <!-- Canal de Logs -->
                        <div class="visual-card">
                            <div class="visual-card-header">
                                <div class="visual-card-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <div class="visual-card-title">Canal de Logs</div>
                                    <div class="visual-card-desc">Registro de actividad del sistema</div>
                                </div>
                            </div>
                            <div class="discord-ui-dropdown-container" id="log_channel_dropdown">
                                <div class="discord-ui-dropdown-trigger" onclick="toggleDiscordUIDropdown('log_channel_dropdown', event)">
                                    <span id="log_channel_display">Seleccionar canal...</span>
                                    <span>▼</span>
                                </div>
                                <div class="discord-ui-dropdown-menu" id="log_channel_menu"></div>
                                <input type="hidden" id="log_channel" value="">
                            </div>
                        </div>

                        <!-- Canal de Transcripciones -->
                        <div class="visual-card">
                            <div class="visual-card-header">
                                <div class="visual-card-icon" style="background: rgba(67, 181, 129, 0.15); color: var(--secondary);">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div>
                                    <div class="visual-card-title">Canal de Transcripciones</div>
                                    <div class="visual-card-desc">Guardar transcripciones de tickets</div>
                                </div>
                            </div>
                            <div class="discord-ui-dropdown-container" id="transcript_channel_dropdown">
                                <div class="discord-ui-dropdown-trigger" onclick="toggleDiscordUIDropdown('transcript_channel_dropdown', event)">
                                    <span id="transcript_channel_display">Seleccionar canal...</span>
                                    <span>▼</span>
                                </div>
                                <div class="discord-ui-dropdown-menu" id="transcript_channel_menu"></div>
                                <input type="hidden" id="transcript_channel" value="">
                            </div>
                        </div>

                        <!-- Canal del Dashboard -->
                        <div class="visual-card">
                            <div class="visual-card-header">
                                <div class="visual-card-icon" style="background: rgba(250, 166, 26, 0.15); color: var(--warning);">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div>
                                    <div class="visual-card-title">Canal del Dashboard</div>
                                    <div class="visual-card-desc">Dashboard en tiempo real</div>
                                </div>
                            </div>
                            <div class="discord-ui-dropdown-container" id="dashboard_channel_dropdown">
                                <div class="discord-ui-dropdown-trigger" onclick="toggleDiscordUIDropdown('dashboard_channel_dropdown', event)">
                                    <span id="dashboard_channel_display">Seleccionar canal...</span>
                                    <span>▼</span>
                                </div>
                                <div class="discord-ui-dropdown-menu" id="dashboard_channel_menu"></div>
                                <input type="hidden" id="dashboard_channel" value="">
                            </div>
                        </div>

                        <!-- Canal de Reporte Semanal -->
                        <div class="visual-card">
                            <div class="visual-card-header">
                                <div class="visual-card-icon" style="background: rgba(155, 89, 182, 0.15); color: #9b59b6;">
                                    <i class="fas fa-calendar-week"></i>
                                </div>
                                <div>
                                    <div class="visual-card-title">Canal de Reporte Semanal</div>
                                    <div class="visual-card-desc">Reportes automáticos semanales</div>
                                </div>
                            </div>
                            <div class="discord-ui-dropdown-container" id="weekly_report_channel_dropdown">
                                <div class="discord-ui-dropdown-trigger" onclick="toggleDiscordUIDropdown('weekly_report_channel_dropdown', event)">
                                    <span id="weekly_report_channel_display">Seleccionar canal...</span>
                                    <span>▼</span>
                                </div>
                                <div class="discord-ui-dropdown-menu" id="weekly_report_channel_menu"></div>
                                <input type="hidden" id="weekly_report_channel" value="">
                            </div>
                        </div>

                        <!-- Canal del Panel de Tickets -->
                        <div class="visual-card">
                            <div class="visual-card-header">
                                <div class="visual-card-icon" style="background: rgba(114, 137, 218, 0.15); color: var(--primary);">
                                    <i class="fas fa-ticket-alt"></i>
                                </div>
                                <div>
                                    <div class="visual-card-title">Canal del Panel de Tickets</div>
                                    <div class="visual-card-desc">Donde está el panel de tickets</div>
                                </div>
                            </div>
                            <div class="discord-ui-dropdown-container" id="panel_channel_id_dropdown">
                                <div class="discord-ui-dropdown-trigger" onclick="toggleDiscordUIDropdown('panel_channel_id_dropdown', event)">
                                    <span id="panel_channel_id_display">Seleccionar canal...</span>
                                    <span>▼</span>
                                </div>
                                <div class="discord-ui-dropdown-menu" id="panel_channel_id_menu"></div>
                                <input type="hidden" id="panel_channel_id" value="">
                            </div>
                        </div>
                    </div>

                    <!-- Roles Tab -->
                    <div class="config-content" id="tab-roles">
                        <!-- Rol de Soporte -->
                        <div class="visual-card">
                            <div class="visual-card-header">
                                <div class="visual-card-icon">
                                    <i class="fas fa-headset"></i>
                                </div>
                                <div>
                                    <div class="visual-card-title">Rol de Soporte</div>
                                    <div class="visual-card-desc">Equipo de atención al usuario</div>
                                </div>
                            </div>
                            <div class="discord-ui-dropdown-container" id="support_role_dropdown">
                                <div class="discord-ui-dropdown-trigger" onclick="toggleDiscordUIDropdown('support_role_dropdown', event)">
                                    <span id="support_role_display">Seleccionar rol...</span>
                                    <span class="discord-ui-arrow">▼</span>
                                </div>
                                <div class="discord-ui-dropdown-menu" id="support_role_menu"></div>
                                <input type="hidden" id="support_role" value="">
                            </div>
                        </div>

                        <!-- Rol de Administrador -->
                        <div class="visual-card">
                            <div class="visual-card-header">
                                <div class="visual-card-icon" style="background: rgba(237, 66, 69, 0.15); color: var(--danger);">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <div>
                                    <div class="visual-card-title">Rol de Administrador</div>
                                    <div class="visual-card-desc">Control total del bot</div>
                                </div>
                            </div>
                            <div class="discord-ui-dropdown-container" id="admin_role_dropdown">
                                <div class="discord-ui-dropdown-trigger" onclick="toggleDiscordUIDropdown('admin_role_dropdown', event)">
                                    <span id="admin_role_display">Seleccionar rol...</span>
                                    <span class="discord-ui-arrow">▼</span>
                                </div>
                                <div class="discord-ui-dropdown-menu" id="admin_role_menu"></div>
                                <input type="hidden" id="admin_role" value="">
                            </div>
                        </div>

                        <!-- Rol de Verificación -->
                        <div class="visual-card">
                            <div class="visual-card-header">
                                <div class="visual-card-icon" style="background: rgba(67, 181, 129, 0.15); color: var(--secondary);">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div>
                                    <div class="visual-card-title">Rol de Verificación</div>
                                    <div class="visual-card-desc">Mínimo para abrir tickets (0 = desactivar)</div>
                                </div>
                            </div>
                            <div class="discord-ui-dropdown-container" id="verify_role_dropdown">
                                <div class="discord-ui-dropdown-trigger" onclick="toggleDiscordUIDropdown('verify_role_dropdown', event)">
                                    <span id="verify_role_display">Seleccionar rol...</span>
                                    <span class="discord-ui-arrow">▼</span>
                                </div>
                                <div class="discord-ui-dropdown-menu" id="verify_role_menu"></div>
                                <input type="hidden" id="verify_role" value="">
                            </div>
                        </div>
                    </div>

                    <!-- Tickets Tab -->
                    <div class="config-content" id="tab-tickets">
                        <!-- Límites de Tickets - Tarjetas Visuales -->
                        <div class="visual-cards-grid">
                            <!-- Máximo de Tickets -->
                            <div class="visual-card">
                                <div class="visual-card-header">
                                    <div class="visual-card-icon">
                                        <i class="fas fa-ticket"></i>
                                    </div>
                                    <div>
                                        <div class="visual-card-title">Máximo de Tickets</div>
                                        <div class="visual-card-desc">Tickets por usuario</div>
                                    </div>
                                </div>
                                <div class="visual-select" id="maxTicketsSelect">
                                    <button class="visual-select-btn" onclick="toggleVisualSelect('maxTicketsSelect')">
                                        <span class="value"><i class="fas fa-layer-group"></i> <span id="maxTicketsText">3 tickets</span></span>
                                        <span class="arrow"><i class="fas fa-chevron-down"></i></span>
                                    </button>
                                    <div class="visual-select-dropdown">
                                        <div class="visual-select-option" data-value="1" onclick="selectVisualOption('maxTicketsSelect', '1', '1 ticket')">
                                            <span class="option-icon"><i class="fas fa-1"></i></span>
                                            1 ticket
                                        </div>
                                        <div class="visual-select-option" data-value="2" onclick="selectVisualOption('maxTicketsSelect', '2', '2 tickets')">
                                            <span class="option-icon"><i class="fas fa-2"></i></span>
                                            2 tickets
                                        </div>
                                        <div class="visual-select-option selected" data-value="3" onclick="selectVisualOption('maxTicketsSelect', '3', '3 tickets')">
                                            <span class="option-icon"><i class="fas fa-3"></i></span>
                                            3 tickets
                                        </div>
                                        <div class="visual-select-option" data-value="5" onclick="selectVisualOption('maxTicketsSelect', '5', '5 tickets')">
                                            <span class="option-icon"><i class="fas fa-5"></i></span>
                                            5 tickets
                                        </div>
                                        <div class="visual-select-option" data-value="10" onclick="selectVisualOption('maxTicketsSelect', '10', '10 tickets')">
                                            <span class="option-icon"><i class="fas fa-10"></i></span>
                                            10 tickets
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="max_tickets" value="3">
                            </div>

                            <!-- Límite Global -->
                            <div class="visual-card">
                                <div class="visual-card-header">
                                    <div class="visual-card-icon" style="background: rgba(67, 181, 129, 0.15); color: var(--secondary);">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                    <div>
                                        <div class="visual-card-title">Límite Global</div>
                                        <div class="visual-card-desc">Total de tickets abiertos</div>
                                    </div>
                                </div>
                                <div class="visual-select" id="globalLimitSelect">
                                    <button class="visual-select-btn" onclick="toggleVisualSelect('globalLimitSelect')">
                                        <span class="value"><i class="fas fa-infinity"></i> <span id="globalLimitText">Sin límite</span></span>
                                        <span class="arrow"><i class="fas fa-chevron-down"></i></span>
                                    </button>
                                    <div class="visual-select-dropdown">
                                        <div class="visual-select-option selected" data-value="0" onclick="selectVisualOption('globalLimitSelect', '0', 'Sin límite')">
                                            <span class="option-icon"><i class="fas fa-infinity"></i></span>
                                            Sin límite
                                        </div>
                                        <div class="visual-select-option" data-value="25" onclick="selectVisualOption('globalLimitSelect', '25', '25 tickets')">
                                            <span class="option-icon"><i class="fas fa-2"></i></span>
                                            25 tickets
                                        </div>
                                        <div class="visual-select-option" data-value="50" onclick="selectVisualOption('globalLimitSelect', '50', '50 tickets')">
                                            <span class="option-icon"><i class="fas fa-5"></i></span>
                                            50 tickets
                                        </div>
                                        <div class="visual-select-option" data-value="100" onclick="selectVisualOption('globalLimitSelect', '100', '100 tickets')">
                                            <span class="option-icon"><i class="fas fa-1"></i></span>
                                            100 tickets
                                        </div>
                                        <div class="visual-select-option" data-value="500" onclick="selectVisualOption('globalLimitSelect', '500', '500 tickets')">
                                            <span class="option-icon"><i class="fas fa-5"></i></span>
                                            500 tickets
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="global_ticket_limit" value="0">
                            </div>

                            <!-- Cooldown -->
                            <div class="visual-card">
                                <div class="visual-card-header">
                                    <div class="visual-card-icon" style="background: rgba(250, 166, 26, 0.15); color: var(--warning);">
                                        <i class="fas fa-hourglass-half"></i>
                                    </div>
                                    <div>
                                        <div class="visual-card-title">Tiempo de Espera</div>
                                        <div class="visual-card-desc">Cooldown entre tickets</div>
                                    </div>
                                </div>
                                <div class="visual-select" id="cooldownSelect">
                                    <button class="visual-select-btn" onclick="toggleVisualSelect('cooldownSelect')">
                                        <span class="value"><i class="fas fa-bell-slash"></i> <span id="cooldownText">Desactivado</span></span>
                                        <span class="arrow"><i class="fas fa-chevron-down"></i></span>
                                    </button>
                                    <div class="visual-select-dropdown">
                                        <div class="visual-select-option selected" data-value="0" onclick="selectVisualOption('cooldownSelect', '0', 'Desactivado')">
                                            <span class="option-icon"><i class="fas fa-bell-slash"></i></span>
                                            Desactivado
                                        </div>
                                        <div class="visual-select-option" data-value="5" onclick="selectVisualOption('cooldownSelect', '5', '5 minutos')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            5 minutos
                                        </div>
                                        <div class="visual-select-option" data-value="15" onclick="selectVisualOption('cooldownSelect', '15', '15 minutos')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            15 minutos
                                        </div>
                                        <div class="visual-select-option" data-value="30" onclick="selectVisualOption('cooldownSelect', '30', '30 minutos')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            30 minutos
                                        </div>
                                        <div class="visual-select-option" data-value="60" onclick="selectVisualOption('cooldownSelect', '60', '1 hora')">
                                            <span class="option-icon"><i class="fas fa-hourglass-start"></i></span>
                                            1 hora
                                        </div>
                                        <div class="visual-select-option" data-value="1440" onclick="selectVisualOption('cooldownSelect', '1440', '24 horas')">
                                            <span class="option-icon"><i class="fas fa-calendar-day"></i></span>
                                            24 horas
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="cooldown_minutes" value="0">
                            </div>

                            <!-- Días mínimos -->
                            <div class="visual-card">
                                <div class="visual-card-header">
                                    <div class="visual-card-icon" style="background: rgba(155, 89, 182, 0.15); color: #9b59b6;">
                                        <i class="fas fa-user-clock"></i>
                                    </div>
                                    <div>
                                        <div class="visual-card-title">Días en Servidor</div>
                                        <div class="visual-card-desc">Tiempo mínimo requerido</div>
                                    </div>
                                </div>
                                <div class="visual-select" id="minDaysSelect">
                                    <button class="visual-select-btn" onclick="toggleVisualSelect('minDaysSelect')">
                                        <span class="value"><i class="fas fa-check-circle"></i> <span id="minDaysText">Sin requisito</span></span>
                                        <span class="arrow"><i class="fas fa-chevron-down"></i></span>
                                    </button>
                                    <div class="visual-select-dropdown">
                                        <div class="visual-select-option selected" data-value="0" onclick="selectVisualOption('minDaysSelect', '0', 'Sin requisito')">
                                            <span class="option-icon"><i class="fas fa-check-circle"></i></span>
                                            Sin requisito
                                        </div>
                                        <div class="visual-select-option" data-value="1" onclick="selectVisualOption('minDaysSelect', '1', '1 día')">
                                            <span class="option-icon"><i class="fas fa-calendar"></i></span>
                                            1 día
                                        </div>
                                        <div class="visual-select-option" data-value="7" onclick="selectVisualOption('minDaysSelect', '7', '7 días')">
                                            <span class="option-icon"><i class="fas fa-calendar-week"></i></span>
                                            7 días
                                        </div>
                                        <div class="visual-select-option" data-value="30" onclick="selectVisualOption('minDaysSelect', '30', '30 días')">
                                            <span class="option-icon"><i class="fas fa-calendar-alt"></i></span>
                                            30 días
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="min_days" value="0">
                            </div>
                        </div>

                        <!-- Auto-cierre y SLA -->
                        <div class="section-header" style="margin-top: 30px;">
                            <i class="fas fa-clock" style="background: var(--gradient-3);"></i>
                            <h3>Auto-cierre y Notificaciones</h3>
                        </div>

                        <div class="visual-cards-grid">
                            <!-- Auto-cierre -->
                            <div class="visual-card">
                                <div class="visual-card-header">
                                    <div class="visual-card-icon" style="background: rgba(237, 66, 69, 0.15); color: var(--danger);">
                                        <i class="fas fa-door-closed"></i>
                                    </div>
                                    <div>
                                        <div class="visual-card-title">Auto-cierre</div>
                                        <div class="visual-card-desc">Cerrar por inactividad</div>
                                    </div>
                                </div>
                                <div class="visual-select" id="autoCloseSelect">
                                    <button class="visual-select-btn" onclick="toggleVisualSelect('autoCloseSelect')">
                                        <span class="value"><i class="fas fa-power-off"></i> <span id="autoCloseText">Desactivado</span></span>
                                        <span class="arrow"><i class="fas fa-chevron-down"></i></span>
                                    </button>
                                    <div class="visual-select-dropdown">
                                        <div class="visual-select-option selected" data-value="0" onclick="selectVisualOption('autoCloseSelect', '0', 'Desactivado')">
                                            <span class="option-icon"><i class="fas fa-power-off"></i></span>
                                            Desactivado
                                        </div>
                                        <div class="visual-select-option" data-value="30" onclick="selectVisualOption('autoCloseSelect', '30', '30 minutos')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            30 minutos
                                        </div>
                                        <div class="visual-select-option" data-value="60" onclick="selectVisualOption('autoCloseSelect', '60', '1 hora')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            1 hora
                                        </div>
                                        <div class="visual-select-option" data-value="1440" onclick="selectVisualOption('autoCloseSelect', '1440', '24 horas')">
                                            <span class="option-icon"><i class="fas fa-calendar-day"></i></span>
                                            24 horas
                                        </div>
                                        <div class="visual-select-option" data-value="10080" onclick="selectVisualOption('autoCloseSelect', '10080', '7 días')">
                                            <span class="option-icon"><i class="fas fa-calendar-week"></i></span>
                                            7 días
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="auto_close_minutes" value="0">
                            </div>

                            <!-- SLA -->
                            <div class="visual-card">
                                <div class="visual-card-header">
                                    <div class="visual-card-icon" style="background: rgba(114, 137, 218, 0.15); color: var(--primary);">
                                        <i class="fas fa-bell"></i>
                                    </div>
                                    <div>
                                        <div class="visual-card-title">Alerta SLA</div>
                                        <div class="visual-card-desc">Notificación por espera</div>
                                    </div>
                                </div>
                                <div class="visual-select" id="slaSelect">
                                    <button class="visual-select-btn" onclick="toggleVisualSelect('slaSelect')">
                                        <span class="value"><i class="fas fa-bell-slash"></i> <span id="slaText">Desactivado</span></span>
                                        <span class="arrow"><i class="fas fa-chevron-down"></i></span>
                                    </button>
                                    <div class="visual-select-dropdown">
                                        <div class="visual-select-option selected" data-value="0" onclick="selectVisualOption('slaSelect', '0', 'Desactivado')">
                                            <span class="option-icon"><i class="fas fa-bell-slash"></i></span>
                                            Desactivado
                                        </div>
                                        <div class="visual-select-option" data-value="15" onclick="selectVisualOption('slaSelect', '15', '15 minutos')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            15 minutos
                                        </div>
                                        <div class="visual-select-option" data-value="30" onclick="selectVisualOption('slaSelect', '30', '30 minutos')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            30 minutos
                                        </div>
                                        <div class="visual-select-option" data-value="60" onclick="selectVisualOption('slaSelect', '60', '1 hora')">
                                            <span class="option-icon"><i class="fas fa-hourglass-start"></i></span>
                                            1 hora
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="sla_minutes" value="0">
                            </div>

                            <!-- Smart Ping -->
                            <div class="visual-card">
                                <div class="visual-card-header">
                                    <div class="visual-card-icon" style="background: rgba(250, 166, 26, 0.15); color: var(--warning);">
                                        <i class="fas fa-bullhorn"></i>
                                    </div>
                                    <div>
                                        <div class="visual-card-title">Smart Ping</div>
                                        <div class="visual-card-desc">Mencionar al staff</div>
                                    </div>
                                </div>
                                <div class="visual-select" id="smartPingSelect">
                                    <button class="visual-select-btn" onclick="toggleVisualSelect('smartPingSelect')">
                                        <span class="value"><i class="fas fa-bell-slash"></i> <span id="smartPingText">Desactivado</span></span>
                                        <span class="arrow"><i class="fas fa-chevron-down"></i></span>
                                    </button>
                                    <div class="visual-select-dropdown">
                                        <div class="visual-select-option selected" data-value="0" onclick="selectVisualOption('smartPingSelect', '0', 'Desactivado')">
                                            <span class="option-icon"><i class="fas fa-bell-slash"></i></span>
                                            Desactivado
                                        </div>
                                        <div class="visual-select-option" data-value="10" onclick="selectVisualOption('smartPingSelect', '10', '10 minutos')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            10 minutos
                                        </div>
                                        <div class="visual-select-option" data-value="30" onclick="selectVisualOption('smartPingSelect', '30', '30 minutos')">
                                            <span class="option-icon"><i class="fas fa-clock"></i></span>
                                            30 minutos
                                        </div>
                                        <div class="visual-select-option" data-value="60" onclick="selectVisualOption('smartPingSelect', '60', '1 hora')">
                                            <span class="option-icon"><i class="fas fa-hourglass-start"></i></span>
                                            1 hora
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="smart_ping_minutes" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Automation Tab -->
                    <div class="config-content" id="tab-automation">
                        <div class="section-header">
                            <i class="fas fa-history" style="background: var(--gradient-1);"></i>
                            <h3>Registros de Mensajes</h3>
                        </div>
                        
                        <div class="toggle-group-visual" id="logEditsToggle">
                            <div class="toggle-visual-info">
                                <div class="toggle-visual-icon">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="toggle-visual-text">
                                    <h4>Registrar Mensajes Editados</h4>
                                    <p>Guarda un log cuando alguien edita un mensaje</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="log_edits" onchange="updateToggleVisual('logEditsToggle', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="toggle-group-visual" id="logDeletesToggle">
                            <div class="toggle-visual-info">
                                <div class="toggle-visual-icon">
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                                <div class="toggle-visual-text">
                                    <h4>Registrar Mensajes Eliminados</h4>
                                    <p>Guarda un log cuando alguien elimina un mensaje</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="log_deletes" onchange="updateToggleVisual('logDeletesToggle', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- DM Tab -->
                    <div class="config-content" id="tab-dm">
                        <div class="section-header">
                            <i class="fas fa-envelope-open" style="background: var(--gradient-2);"></i>
                            <h3>Mensajes Directos</h3>
                        </div>
                        
                        <div class="toggle-group-visual" id="dmOpenToggle">
                            <div class="toggle-visual-info">
                                <div class="toggle-visual-icon">
                                    <i class="fas fa-envelope-open-text"></i>
                                </div>
                                <div class="toggle-visual-text">
                                    <h4>DM al Abrir Ticket</h4>
                                    <p>Enviar confirmación por DM al abrir</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dm_on_open" onchange="updateToggleVisual('dmOpenToggle', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="toggle-group-visual" id="dmCloseToggle">
                            <div class="toggle-visual-info">
                                <div class="toggle-visual-icon">
                                    <i class="fas fa-envelope-check"></i>
                                </div>
                                <div class="toggle-visual-text">
                                    <h4>DM al Cerrar Ticket</h4>
                                    <p>Enviar notificación por DM al cerrar</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dm_on_close" onchange="updateToggleVisual('dmCloseToggle', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Maintenance Tab -->
                    <div class="config-content" id="tab-maintenance">
                        <div class="maintenance-card" id="maintenanceCard">
                            <div class="maintenance-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <h3>Modo Mantenimiento</h3>
                            <p>Desactiva temporalmente el sistema de tickets para realizar mantenimiento</p>
                            
                            <div class="toggle-group-visual" id="maintenanceToggle" style="max-width: 400px; margin: 0 auto;">
                                <div class="toggle-visual-info">
                                    <div class="toggle-visual-icon">
                                        <i class="fas fa-power-off"></i>
                                    </div>
                                    <div class="toggle-visual-text">
                                        <h4>Activar Mantenimiento</h4>
                                        <p>Usuarios no podrán abrir tickets</p>
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="maintenance_mode" onchange="updateMaintenanceCard(this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group" id="maintenanceReasonGroup" style="display: none;">
                            <label class="form-label">📝 Razón del Mantenimiento</label>
                            <small>Mensaje que verán los usuarios cuando intenten abrir un ticket</small>
                            <input type="text" class="form-input" id="maintenance_reason" placeholder="El sistema está en mantenimiento...">
                        </div>
                    </div>

                    <button class="save-btn" onclick="saveSettings()">
                        <span class="btn-text"><i class="fas fa-save"></i> Guardar Configuración</span>
                        <span class="spinner"></span>
                    </button>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="configEmptyState">
                    <i class="fas fa-server"></i>
                    <h3>Selecciona un Servidor</h3>
                    <p>Elige un servidor de la lista para configurar sus opciones</p>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Enlaces Rápidos</h4>
                    <a href="#" onclick="showHome()"><i class="fas fa-home"></i> Inicio</a>
                    <a href="#" onclick="showConfig()"><i class="fas fa-cog"></i> Configuración</a>
                    <a href="#features"><i class="fas fa-star"></i> Características</a>
                    <a href="#commands"><i class="fas fa-terminal"></i> Comandos</a>
                </div>
                
                <div class="footer-section">
                    <h4>Recursos</h4>
                    <a href="#"><i class="fas fa-book"></i> Documentación</a>
                    <a href="#"><i class="fas fa-code"></i> API</a>
                    <a href="#"><i class="fas fa-users"></i> Servidor de Soporte</a>
                    <a href="#"><i class="fab fa-discord"></i> Únete a nuestra comunidad</a>
                </div>
                
                <div class="footer-section">
                    <h4>Legal</h4>
                    <a href="#"><i class="fas fa-file-alt"></i> Términos de Servicio</a>
                    <a href="#"><i class="fas fa-lock"></i> Política de Privacidad</a>
                    <a href="#"><i class="fas fa-cookie"></i> Política de Cookies</a>
                    <a href="#"><i class="fas fa-gavel"></i> DMCA</a>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p class="footer-copyright">© 2024 <%= botName %>. Todos los derechos reservados.</p>
                <div class="footer-social">
                    <a href="#" title="Discord"><i class="fab fa-discord"></i></a>
                    <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" title="GitHub"><i class="fab fa-github"></i></a>
                    <a href="#" title="YouTube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </footer>
    </main>

    <script>
        let currentGuildId = null;
        let servers = [];

        // Generate floating particles
        const particlesContainer = document.getElementById('particles');
        const particleCount = 20;
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 15 + 's';
            particle.style.animationDuration = (10 + Math.random() * 10) + 's';
            particlesContainer.appendChild(particle);
        }

        // Navigation functions
        function showHome() {
            document.getElementById('homeSection').style.display = 'block';
            document.getElementById('configSection').style.display = 'none';
            document.querySelectorAll('.navbar-links a').forEach(a => a.classList.remove('active'));
            document.querySelector('.navbar-links a:first-child').classList.add('active');
        }

        function showConfig() {
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('configSection').style.display = 'block';
            document.querySelectorAll('.navbar-links a').forEach(a => a.classList.remove('active'));
            document.querySelectorAll('.navbar-links a')[1].classList.add('active');
            loadServers();
        }

        // Server selector
        function toggleServerDropdown() {
            document.getElementById('serverSelector').classList.toggle('open');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.server-selector')) {
                document.getElementById('serverSelector').classList.remove('open');
            }
        });

        // Load servers
        async function loadServers() {
            try {
                const response = await fetch('/api/servers');
                servers = await response.json();
                
                const dropdown = document.getElementById('serverDropdown');
                dropdown.innerHTML = '';
                
                servers.forEach(server => {
                    const option = document.createElement('div');
                    option.className = 'server-option';
                    option.onclick = () => selectServer(server);
                    option.innerHTML = `
                        <img src="${server.icon || '<%= botAvatar %>'}" alt="${server.name}">
                        <div class="server-option-info">
                            <div class="server-option-name">${server.name}</div>
                            <div class="server-option-members">${server.memberCount.toLocaleString()} miembros</div>
                        </div>
                    `;
                    dropdown.appendChild(option);
                });
            } catch (error) {
                showToast('Error al cargar servidores', 'error');
            }
        }

        // Select server
        async function selectServer(server) {
            currentGuildId = server.id;
            
            document.getElementById('selectedServerIcon').src = server.icon || '<%= botAvatar %>';
            document.getElementById('selectedServerName').textContent = server.name;
            document.getElementById('serverSelector').classList.remove('open');
            
            document.getElementById('configEmptyState').style.display = 'none';
            document.getElementById('configPanel').classList.add('active');
            
            document.getElementById('configServerIcon').src = server.icon || '<%= botAvatar %>';
            document.getElementById('configServerName').textContent = server.name;
            document.getElementById('configServerId').textContent = 'ID: ' + server.id;
            
            await loadSettings(server.id);
            await loadCustomChannelDropdowns(server.id);
        }

        // Load settings for a server
        async function loadSettings(guildId) {
            showLoading(true);
            try {
                const response = await fetch(`/api/settings/${guildId}`);
                const data = await response.json();
                
                if (data.settings) {
                    const s = data.settings;
                    
                    // Channels
                    document.getElementById('log_channel').value = s.log_channel || '';
                    document.getElementById('transcript_channel').value = s.transcript_channel || '';
                    document.getElementById('dashboard_channel').value = s.dashboard_channel || '';
                    document.getElementById('weekly_report_channel').value = s.weekly_report_channel || '';
                    document.getElementById('panel_channel_id').value = s.panel_channel_id || '';
                    
                    // Roles
                    document.getElementById('support_role').value = s.support_role || '';
                    document.getElementById('admin_role').value = s.admin_role || '';
                    document.getElementById('verify_role').value = s.verify_role || '';
                    
                    // Tickets
                    document.getElementById('max_tickets').value = s.max_tickets || 3;
                    document.getElementById('global_ticket_limit').value = s.global_ticket_limit || 0;
                    document.getElementById('cooldown_minutes').value = s.cooldown_minutes || 0;
                    document.getElementById('min_days').value = s.min_days || 0;
                    document.getElementById('auto_close_minutes').value = s.auto_close_minutes || 0;
                    document.getElementById('sla_minutes').value = s.sla_minutes || 0;
                    document.getElementById('smart_ping_minutes').value = s.smart_ping_minutes || 0;
                    
                    // Automation
                    document.getElementById('log_edits').checked = s.log_edits !== false;
                    document.getElementById('log_deletes').checked = s.log_deletes !== false;
                    
                    // DM
                    document.getElementById('dm_on_open').checked = s.dm_on_open !== false;
                    document.getElementById('dm_on_close').checked = s.dm_on_close !== false;
                    
                    // Maintenance
                    document.getElementById('maintenance_mode').checked = s.maintenance_mode || false;
                    document.getElementById('maintenance_reason').value = s.maintenance_reason || '';
                    document.getElementById('maintenanceReasonGroup').style.display = s.maintenance_mode ? 'block' : 'none';
                }
            } catch (error) {
                showToast('Error al cargar configuración', 'error');
            }
            showLoading(false);
        }

        // Save settings
        async function saveSettings() {
            if (!currentGuildId) {
                showToast('Selecciona un servidor primero', 'warning');
                return;
            }
            
            const btn = document.querySelector('.save-btn');
            btn.classList.add('loading');
            btn.disabled = true;
            
            const updates = {
                log_channel: parseId(document.getElementById('log_channel').value),
                transcript_channel: parseId(document.getElementById('transcript_channel').value),
                dashboard_channel: parseId(document.getElementById('dashboard_channel').value),
                weekly_report_channel: parseId(document.getElementById('weekly_report_channel').value),
                panel_channel_id: parseId(document.getElementById('panel_channel_id').value),
                support_role: parseId(document.getElementById('support_role').value),
                admin_role: parseId(document.getElementById('admin_role').value),
                verify_role: parseId(document.getElementById('verify_role').value),
                max_tickets: parseInt(document.getElementById('max_tickets').value) || 3,
                global_ticket_limit: parseInt(document.getElementById('global_ticket_limit').value) || 0,
                cooldown_minutes: parseInt(document.getElementById('cooldown_minutes').value) || 0,
                min_days: parseInt(document.getElementById('min_days').value) || 0,
                auto_close_minutes: parseInt(document.getElementById('auto_close_minutes').value) || 0,
                sla_minutes: parseInt(document.getElementById('sla_minutes').value) || 0,
                smart_ping_minutes: parseInt(document.getElementById('smart_ping_minutes').value) || 0,
                log_edits: document.getElementById('log_edits').checked,
                log_deletes: document.getElementById('log_deletes').checked,
                dm_on_open: document.getElementById('dm_on_open').checked,
                dm_on_close: document.getElementById('dm_on_close').checked,
                maintenance_mode: document.getElementById('maintenance_mode').checked,
                maintenance_reason: document.getElementById('maintenance_reason').value || null
            };
            
            try {
                const response = await fetch(`/api/settings/${currentGuildId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Configuración guardada correctamente', 'success');
                } else {
                    showToast(result.error || 'Error al guardar', 'error');
                }
            } catch (error) {
                showToast('Error al guardar configuración', 'error');
            }
            
            btn.classList.remove('loading');
            btn.disabled = false;
        }

        // Parse ID from input (supports #channel, @role, or raw ID)
        function parseId(value) {
            if (!value) return null;
            value = value.trim();
            // If it's a mention format
            if (value.startsWith('<#') && value.endsWith('>')) {
                return value.slice(2, -1);
            }
            if (value.startsWith('<@&') && value.endsWith('>')) {
                return value.slice(3, -1);
            }
            if (value.startsWith('#')) {
                return value.slice(1);
            }
            if (value.startsWith('@')) {
                return value.slice(1);
            }
            // If it's a numeric ID
            if (/^\d+$/.test(value)) {
                return value;
            }
            return null;
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.config-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.config-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.config-tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Maintenance mode toggle visibility
        document.getElementById('maintenance_mode').addEventListener('change', function() {
            document.getElementById('maintenanceReasonGroup').style.display = this.checked ? 'block' : 'none';
        });

        // Visual Select Functions
        function toggleVisualSelect(selectId) {
            const select = document.getElementById(selectId);
            select.classList.toggle('open');
        }

        function selectVisualOption(selectId, value, text) {
            const select = document.getElementById(selectId);
            const hiddenInput = select.parentElement.querySelector('input[type="hidden"]');
            const textSpan = select.querySelector('#' + selectId.replace('Select', 'Text') || select.querySelector('.value span:last-child'));

            // Update hidden input
            if (hiddenInput) {
                hiddenInput.value = value;
            }

            // Update display text
            const valueSpan = select.querySelector('.value');
            if (valueSpan) {
                const icon = valueSpan.querySelector('i') ? valueSpan.querySelector('i').outerHTML + ' ' : '';
                valueSpan.innerHTML = icon + text;
            }

            // Update selected class
            const options = select.querySelectorAll('.visual-select-option');
            options.forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.value === value) {
                    opt.classList.add('selected');
                }
            });

            // Close dropdown
            select.classList.remove('open');
        }

        // Visual Toggle Functions
        function updateToggleVisual(toggleId, isActive) {
            const toggle = document.getElementById(toggleId);
            if (isActive) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        // Maintenance Card Function
        function updateMaintenanceCard(isActive) {
            const card = document.getElementById('maintenanceCard');
            const reasonGroup = document.getElementById('maintenanceReasonGroup');

            if (isActive) {
                card.classList.add('active');
                reasonGroup.style.display = 'block';
            } else {
                card.classList.remove('active');
                reasonGroup.style.display = 'none';
            }
        }

        // Close visual selects when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.visual-select')) {
                document.querySelectorAll('.visual-select.open').forEach(select => {
                    select.classList.remove('open');
                });
            }
        });

        // Initialize visual selects based on loaded values
        function initVisualSelects() {
            // Map of select IDs to their corresponding hidden input IDs
            const selectMappings = {
                'maxTicketsSelect': { input: 'max_tickets', textMap: { '1': '1 ticket', '2': '2 tickets', '3': '3 tickets', '5': '5 tickets', '10': '10 tickets' }},
                'globalLimitSelect': { input: 'global_ticket_limit', textMap: { '0': 'Sin límite', '25': '25 tickets', '50': '50 tickets', '100': '100 tickets', '500': '500 tickets' }},
                'cooldownSelect': { input: 'cooldown_minutes', textMap: { '0': 'Desactivado', '5': '5 minutos', '15': '15 minutos', '30': '30 minutos', '60': '1 hora', '1440': '24 horas' }},
                'minDaysSelect': { input: 'min_days', textMap: { '0': 'Sin requisito', '1': '1 día', '7': '7 días', '30': '30 días' }},
                'autoCloseSelect': { input: 'auto_close_minutes', textMap: { '0': 'Desactivado', '30': '30 minutos', '60': '1 hora', '1440': '24 horas', '10080': '7 días' }},
                'slaSelect': { input: 'sla_minutes', textMap: { '0': 'Desactivado', '15': '15 minutos', '30': '30 minutos', '60': '1 hora' }},
                'smartPingSelect': { input: 'smart_ping_minutes', textMap: { '0': 'Desactivado', '10': '10 minutos', '30': '30 minutos', '60': '1 hora' }}
            };

            for (const [selectId, config] of Object.entries(selectMappings)) {
                const input = document.getElementById(config.input);
                if (input && input.value) {
                    const text = config.textMap[input.value] || input.value;
                    const select = document.getElementById(selectId);
                    if (select) {
                        const valueSpan = select.querySelector('.value');
                        if (valueSpan) {
                            const icon = valueSpan.querySelector('i') ? valueSpan.querySelector('i').outerHTML + ' ' : '';
                            valueSpan.innerHTML = icon + text;
                        }

                        // Update selected class
                        const options = select.querySelectorAll('.visual-select-option');
                        options.forEach(opt => {
                            opt.classList.remove('selected');
                            if (opt.dataset.value === input.value) {
                                opt.classList.add('selected');
                            }
                        });
                    }
                }
            }

            // Initialize toggles
            updateToggleVisual('logEditsToggle', document.getElementById('log_edits').checked);
            updateToggleVisual('logDeletesToggle', document.getElementById('log_deletes').checked);
            updateToggleVisual('dmOpenToggle', document.getElementById('dm_on_open').checked);
            updateToggleVisual('dmCloseToggle', document.getElementById('dm_on_close').checked);
            updateMaintenanceCard(document.getElementById('maintenance_mode').checked);
        }

        // Load settings and initialize visual selects
        const originalLoadSettings = loadSettings;
        loadSettings = async function(guildId) {
            await originalLoadSettings(guildId);
            initVisualSelects();
        };

        // Loading overlay
        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('active', show);
        }

        // Toast notifications
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                ${message}
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.style.background = 'rgba(15, 15, 26, 0.95)';
            } else {
                navbar.style.background = 'rgba(15, 15, 26, 0.8)';
            }
        });

        // ===== NUEVO SISTEMA DE DROPDOWNS DISCORD UI - IMPLEMENTACIÓN DEFINITIVA =====

        // Almacenar datos de canales y roles globalmente para uso en los dropdowns
        let discordChannelsData = [];
        let discordRolesData = [];

        // Función para renderizar el dropdown de roles
        function renderDiscordRoleDropdown(containerId, roles, selectedRoleId) {
            const containerTarget = document.getElementById(containerId);
            if (!containerTarget) return;
            
            // Limpiar contenedor base
            containerTarget.innerHTML = '';

            // 1. Crear ESTRUCTURA
            const wrapper = document.createElement('div');
            wrapper.className = 'discord-ui-dropdown-container';

            const trigger = document.createElement('div');
            trigger.className = 'discord-ui-dropdown-trigger';
            
            // Determinar texto inicial basado en valor seleccionado
            let initialText = 'Seleccionar rol...';
            if (selectedRoleId) {
                const selectedRole = roles.find(r => r.id === selectedRoleId);
                initialText = selectedRole ? `@${selectedRole.name}` : '@ Rol Seleccionado';
            }
            
            trigger.innerHTML = `<span>${initialText}</span> <span class="discord-ui-arrow">▼</span>`;

            const menu = document.createElement('div');
            menu.className = 'discord-ui-dropdown-menu';
            
            // FORZAR estilos críticos en línea
            menu.style.setProperty('background-color', '#2b2d31', 'important');
            menu.style.setProperty('opacity', '1', 'important');
            menu.style.setProperty('border', '1px solid #1e1f22', 'important');
            menu.style.setProperty('box-shadow', '0 8px 16px rgba(0,0,0,0.9)', 'important');
            menu.style.setProperty('z-index', '999999', 'important');

            // 2. Llenar el menú con roles
            let menuHTML = '';
            
            // Opción "Ninguno" primero
            menuHTML += `<div class="discord-ui-option" data-role-id="">`;
            menuHTML += `<i class="fas fa-times-circle" style="margin-right: 8px;"></i> Ninguno`;
            menuHTML += `</div>`;

            // Ordenar roles por posición (los de mayor posición arriba)
            const sortedRoles = [...roles].sort((a, b) => b.position - a.position);

            // Añadir roles
            sortedRoles.forEach(role => {
                if (role.id !== role.guildId) { // Excluir @everyone
                    const isSelected = selectedRoleId === role.id;
                    const roleColor = role.color ? '#' + role.color.toString(16).padStart(6, '0') : '#a3a6aa';
                    
                    menuHTML += `<div class="discord-ui-option${isSelected ? ' selected' : ''}" data-role-id="${role.id}">`;
                    menuHTML += `<span class="role-color" style="width: 12px; height: 12px; border-radius: 3px; background-color: ${roleColor}; margin-right: 8px; flex-shrink: 0;"></span>`;
                    menuHTML += `@ ${role.name}`;
                    menuHTML += `</div>`;
                }
            });

            menu.innerHTML = menuHTML;

            // 3. Lógica del Toggle
            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = wrapper.classList.contains('is-open');
                
                // Cerrar los demás dropdowns
                document.querySelectorAll('.discord-ui-dropdown-container.is-open').forEach(el => {
                    el.classList.remove('is-open');
                });

                if (!isOpen) {
                    wrapper.classList.add('is-open');
                }
            });

            // 4. Lógica de selección de opción
            menu.addEventListener('click', (e) => {
                const option = e.target.closest('.discord-ui-option');
                if (option) {
                    const roleId = option.dataset.roleId;
                    const roleName = option.textContent.trim();
                    
                    // Actualizar el display
                    trigger.innerHTML = `<span>${roleName}</span> <span class="discord-ui-arrow">▼</span>`;
                    
                    // Actualizar el input hidden
                    const hiddenInput = containerTarget.querySelector('input[type="hidden"]');
                    if (hiddenInput) {
                        hiddenInput.value = roleId || '';
                    }
                    
                    // Cerrar el menú
                    wrapper.classList.remove('is-open');
                }
            });

            // 5. Ensamblar
            wrapper.appendChild(trigger);
            wrapper.appendChild(menu);
            containerTarget.appendChild(wrapper);
        }

        // Función para cargar roles y renderizar los dropdowns
        async function loadAndRenderRoleDropdowns(guildId, savedSettings) {
            try {
                const response = await fetch('/api/roles/' + guildId);
                const data = await response.json();
                discordRolesData = data.roles || [];

                // Configuración de cada dropdown de roles
                const roleDropdownConfigs = [
                    { 
                        containerId: 'support_role_dropdown', 
                        inputId: 'support_role', 
                        settingKey: 'support_role' 
                    },
                    { 
                        containerId: 'admin_role_dropdown', 
                        inputId: 'admin_role', 
                        settingKey: 'admin_role' 
                    },
                    { 
                        containerId: 'verify_role_dropdown', 
                        inputId: 'verify_role', 
                        settingKey: 'verify_role' 
                    }
                ];

                roleDropdownConfigs.forEach(config => {
                    const savedValue = savedSettings ? savedSettings[config.settingKey] : '';
                    renderDiscordRoleDropdown(config.containerId, discordRolesData, savedValue);
                });

            } catch (error) {
                console.error('Error loading role dropdowns:', error);
            }
        }


        // Función para togglear el dropdown (usada por los triggers estáticos en HTML)
        function toggleDiscordUIDropdown(containerId, event) {
            event.stopPropagation();
            
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Toggle the is-open class
            const isOpen = container.classList.contains('is-open');
            
            // Cerrar todos los demás dropdowns primero
            document.querySelectorAll('.discord-ui-dropdown-container.is-open').forEach(el => {
                if (el !== container) {
                    el.classList.remove('is-open');
                }
            });
            
            // Toggle este dropdown
            if (isOpen) {
                container.classList.remove('is-open');
                // Limpiar z-index del padre al cerrar
                cleanupDropdownZIndexes();
            } else {
                container.classList.add('is-open');
                // Forzar z-index del padre al abrir
                elevateDropdownParent(container);
            }
        }

        // Función para elevar la tarjeta directamente (más confiable que el padre)
        function elevateDropdownParent(menuContainer) {
            // Buscar la tarjeta (visual-card o pando-setting-card)
            const card = menuContainer.closest('.visual-card') || menuContainer.closest('.pando-setting-card');
            if (!card) return;

            // Forzar z-index directamente en la tarjeta
            card.style.position = 'relative';
            card.style.zIndex = '999999';

            // CANDADO INQUEBRANTABLE: Elevar también la celda del Grid padre
            const gridCell = card.parentElement;
            if (gridCell) {
                gridCell.style.setProperty('z-index', '999999', 'important');
            }
        }

        // Función para limpiar todos los z-index de las tarjetas
        function cleanupDropdownZIndexes() {
            // Limpiar todas las tarjetas
            document.querySelectorAll('.visual-card, .pando-setting-card').forEach(card => {
                card.style.zIndex = '';
                card.style.position = '';
            });
            
            // Limpiar z-index de las celdas del Grid padre
            document.querySelectorAll('.pando-setting-card, .visual-card').forEach(card => {
                const gridCell = card.parentElement;
                if (gridCell) {
                    gridCell.style.removeProperty('z-index');
                }
            });
        }

        // Función PRINCIPAL para renderizar el dropdown de canales
        function renderDiscordChannelDropdown(containerId, channels, selectedChannelId) {
            const containerTarget = document.getElementById(containerId);
            if (!containerTarget) return;
            
            // Limpiar contenedor base
            containerTarget.innerHTML = '';

            // 1. Crear ESTRUCTURA
            const wrapper = document.createElement('div');
            wrapper.className = 'discord-ui-dropdown-container';

            const trigger = document.createElement('div');
            trigger.className = 'discord-ui-dropdown-trigger';
            
            // Determinar texto inicial basado en valor seleccionado
            let initialText = 'Seleccionar canal...';
            if (selectedChannelId) {
                const selectedChannel = channels.find(c => c.id === selectedChannelId);
                initialText = selectedChannel ? `#${selectedChannel.name}` : '# Canal Seleccionado';
            }
            
            trigger.innerHTML = `<span>${initialText}</span> <span class="discord-ui-arrow">▼</span>`;

            const menu = document.createElement('div');
            menu.className = 'discord-ui-dropdown-menu';
            
            // FORZAR estilos críticos en línea para ganar especificidad contra el CSS del framework
            menu.style.setProperty('background-color', '#2b2d31', 'important');
            menu.style.setProperty('opacity', '1', 'important');
            menu.style.setProperty('border', '1px solid #1e1f22', 'important');
            menu.style.setProperty('box-shadow', '0 8px 16px rgba(0,0,0,0.9)', 'important');
            menu.style.setProperty('z-index', '999999', 'important');

            // 2. Llenar el menú con canales agrupados por categoría
            let menuHTML = '';
            
            // Opción "Ninguno" primero
            menuHTML += `<div class="discord-ui-option" data-channel-id="">`;
            menuHTML += `<i class="fas fa-times-circle" style="margin-right: 8px;"></i> Ninguno`;
            menuHTML += `</div>`;

            // Agrupar canales por categoría
            const categories = {};
            let noCategory = [];

            channels.forEach(channel => {
                if (channel.type === 0) { // Text channel
                    if (channel.parentId && categories[channel.parentId]) {
                        categories[channel.parentId].push(channel);
                    } else {
                        noCategory.push(channel);
                    }
                } else if (channel.type === 4) { // Category
                    categories[channel.id] = [];
                }
            });

            // Añadir canales categorizados
            Object.keys(categories).forEach(catId => {
                const catChannels = categories[catId];
                if (catChannels.length > 0) {
                    const cat = channels.find(c => c.id === catId);
                    const catName = cat ? cat.name : 'Categoría';

                    menuHTML += `<div class="discord-ui-category">📁 ${catName}</div>`;

                    catChannels.forEach(channel => {
                        const isSelected = selectedChannelId === channel.id;
                        menuHTML += `<div class="discord-ui-option${isSelected ? ' selected' : ''}" data-channel-id="${channel.id}">`;
                        menuHTML += `<i class="fas fa-hashtag" style="margin-right: 8px; opacity: 0.6;"></i> ${channel.name}`;
                        menuHTML += `</div>`;
                    });
                }
            });

            // Añadir canales sin categoría
            if (noCategory.length > 0) {
                menuHTML += `<div class="discord-ui-category">📋 Canales</div>`;

                noCategory.forEach(channel => {
                    const isSelected = selectedChannelId === channel.id;
                    menuHTML += `<div class="discord-ui-option${isSelected ? ' selected' : ''}" data-channel-id="${channel.id}">`;
                    menuHTML += `<i class="fas fa-hashtag" style="margin-right: 8px; opacity: 0.6;"></i> ${channel.name}`;
                    menuHTML += `</div>`;
                });
            }

            menu.innerHTML = menuHTML;

            // 3. Lógica del Toggle (SIMPLE Y AISLADA)
            // El z-index ahora se maneja automáticamente con CSS :has()
            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = wrapper.classList.contains('is-open');
                
                // Cerrar los demás dropdowns
                document.querySelectorAll('.discord-ui-dropdown-container.is-open').forEach(el => {
                    el.classList.remove('is-open');
                });

                if (!isOpen) {
                    wrapper.classList.add('is-open');
                }
            });

            // 4. Lógica de selección de opción
            menu.addEventListener('click', (e) => {
                const option = e.target.closest('.discord-ui-option');
                if (option && !option.classList.contains('discord-ui-category')) {
                    const channelId = option.dataset.channelId;
                    const channelName = option.textContent.trim();
                    
                    // Actualizar el display
                    trigger.innerHTML = `<span>${channelName}</span> <span class="discord-ui-arrow">▼</span>`;
                    
                    // Actualizar el input hidden
                    const hiddenInput = containerTarget.querySelector('input[type="hidden"]');
                    if (hiddenInput) {
                        hiddenInput.value = channelId || '';
                    }
                    
                    // Cerrar el menú
                    wrapper.classList.remove('is-open');
                }
            });

            // 5. Ensamblar (CRUCIAL: trigger y menu DENTRO del wrapper)
            wrapper.appendChild(trigger);
            wrapper.appendChild(menu);
            containerTarget.appendChild(wrapper);
        }

        // Función para cargar canales y renderizar TODOS los dropdowns
        async function loadAndRenderChannelDropdowns(guildId, savedSettings) {
            // Bloquear actualizaciones del DOM si el usuario está interactuando con un menú
            if (document.querySelector('.discord-ui-dropdown-container.is-open')) {
                console.log("Actualización en tiempo real pausada: Menú abierto.");
                return; // Aborta la actualización para no destruir la UI activa
            }

            try {
                const response = await fetch('/api/channels/' + guildId);
                const data = await response.json();
                discordChannelsData = data.channels || [];

                // Configuración de cada dropdown
                const dropdownConfigs = [
                    { 
                        containerId: 'log_channel_dropdown', 
                        inputId: 'log_channel', 
                        settingKey: 'log_channel' 
                    },
                    { 
                        containerId: 'transcript_channel_dropdown', 
                        inputId: 'transcript_channel', 
                        settingKey: 'transcript_channel' 
                    },
                    { 
                        containerId: 'dashboard_channel_dropdown', 
                        inputId: 'dashboard_channel', 
                        settingKey: 'dashboard_channel' 
                    },
                    { 
                        containerId: 'weekly_report_channel_dropdown', 
                        inputId: 'weekly_report_channel', 
                        settingKey: 'weekly_report_channel' 
                    },
                    { 
                        containerId: 'panel_channel_id_dropdown', 
                        inputId: 'panel_channel_id', 
                        settingKey: 'panel_channel_id' 
                    }
                ];

                dropdownConfigs.forEach(config => {
                    const savedValue = savedSettings ? savedSettings[config.settingKey] : '';
                    renderDiscordChannelDropdown(config.containerId, discordChannelsData, savedValue);
                });

            } catch (error) {
                console.error('Error loading channel dropdowns:', error);
            }
        }

        // Listener global para cerrar al hacer clic fuera
        document.addEventListener('click', () => {
            document.querySelectorAll('.discord-ui-dropdown-container.is-open').forEach(el => {
                el.classList.remove('is-open');
            });
            // Limpiar z-index de los padres al cerrar por clic fuera
            cleanupDropdownZIndexes();
        });

        // Override de loadSettings para usar el nuevo sistema de dropdowns
        const originalLoadSettings3 = loadSettings;
        loadSettings = async function(guildId) {
            // Guardar los settings antes de llamar al original
            let currentSettings = {};

            // Cargar settings primero
            try {
                const response = await fetch(`/api/settings/${guildId}`);
                const data = await response.json();
                if (data.settings) {
                    currentSettings = data.settings;
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }

            // Llamar al original
            await originalLoadSettings3(guildId);

            // Después de cargar settings, renderizar los dropdowns con los datos reales
            await loadAndRenderChannelDropdowns(guildId, currentSettings);
            await loadAndRenderRoleDropdowns(guildId, currentSettings);
        };
    </script>
</body>
</html>
